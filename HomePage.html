<html>

    <head>

        <title>Smart Bid Functional Tests</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    </head>

    <body>

        <script src="./sources/HttpRestAPIClient.js"></script>
        <script src="./sources/GlobalsForClient.js"></script>
        <script src="./sources/ClientInputValidator.js"></script>
        <script src="./sources/ProcessFormInput.js"></script>
        <script src="./sources/PublishAssetValidator.js"></script>
        <script src="./sources/PlaceBidValidator.js"></script>


        <br/><br/><br/>

        <div class="container">

            <button class="btn btn-primary" onclick="executeCustomerSignupFunctionalTest()">Execute SmartBid Functional Tests</button>

            <br/><br/><br/>
            <p style = "color: brown;">=================================================================================</p>
            <p style = "color: brown;">Customer SignUp Tests</p>
            <p style = "color: brown;">=================================================================================</p>

            <p id="customerSignUpTest_container"></p>
            <p id="customerRecordRetrievalTest_container"></p>
            <p id="customerLogInTest_container"></p>
            <p id="customerRecordRemoval_container"></p>
            <p id="customerRecordRemovalConfirmation_container"></p>

            <br/><br/>
            <p style = "color: brown;">=================================================================================</p>
            <p style = "color: brown;">Publish Asset Tests</p>
            <p style = "color: brown;">=================================================================================</p>

            <p id="publishAssetTest_container"></p>
            <p id="assetRecordRetrievalTest_container"></p>
            <p id="assetRecordRemovalTest_container"></p>
            <p id="assetRecordRemovalConfirmation_container"></p>

            <br/><br/>
            <p style = "color: brown;">=================================================================================</p>
            <p style = "color: brown;">Place Open Bids Tests</p>
            <p style = "color: brown;">=================================================================================</p>

            <p id="placeOpenBid_PublishAssetTest_container"></p>
            <p id="placeOpenBid_AssetRecordRetrievalTest_container"></p>

            <br/>

            <p id="placeOpenBid_PlaceBidTest_container"></p>
            <p id="placeOpenBid_RetrieveBidTest_container"></p>
            <p id="placeOpenBid_RetrieveBidAssetTest_container"></p>

            <br/>
            
            <p id="placeOpenBid_PlaceBetterBidTest_container"></p>
            <p id="placeOpenBid_RetrieveBetterBidTest_container"></p>
            <p id="placeOpenBid_RetrieveBetterBidAssetTest_container"></p>

            <br/>
            
            <p id="placeOpenBid_bidRecordRemovalTest_container"></p>
            <p id="placeOpenBid_bidRecordRemovalConfirmation_container"></p>

            <br/>
            
            <p id="placeOpenBid_assetBidRecordRemovalTest_container"></p>
            <p id="placeOpenBid_assetBidRecordRemovalConfirmation_container"></p>

            <br/><br/>
            <p style = "color: brown;">=================================================================================</p>
            <p style = "color: brown;">Place Secretive Bids Tests</p>
            <p style = "color: brown;">=================================================================================</p>

            <p id="placeSecretiveBid_PublishAssetTest_container"></p>
            <p id="placeSecretiveBid_AssetRecordRetrievalTest_container"></p>

            <br/>

            <p id="placeSecretiveBid_PlaceBidTest_container"></p>
            <p id="placeSecretiveBid_RetrieveBidTest_container"></p>
            <p id="placeSecretiveBid_RetrieveBidAssetTest_container"></p>

            <br/>
            
            <p id="placeSecretiveBid_PlaceBetterBidTest_container"></p>
            <p id="placeSecretiveBid_RetrieveBetterBidTest_container"></p>
            <p id="placeSecretiveBid_RetrieveBetterBidAssetTest_container"></p>

            <br/>
            
            <p id="placeSecretiveBid_bidRecordRemovalTest_container"></p>
            <p id="placeSecretiveBid_bidRecordRemovalConfirmation_container"></p>

            <br/>
            
            <p id="placeSecretiveBid_assetBidRecordRemovalTest_container"></p>
            <p id="placeSecretiveBid_assetBidRecordRemovalConfirmation_container"></p>

        </div>

        <script>


            // Customer Sign Up Test

            async function executeCustomerSignupFunctionalTest()
            {
                
                let customerDetailsObject = {};

                // customerDetailsObject = GlobalsForClientModule.customerRecordObject;

                for( let currentCustomerRecordKey in GlobalsForClientModule.customerRecordObject )
                {
                    customerDetailsObject[currentCustomerRecordKey] = GlobalsForClientModule.customerRecordObject[currentCustomerRecordKey];
                }

                customerDetailsObject.Password = window.btoa(GlobalsForClientModule.customerRecordObject.Password);

                await HttpRestAPIClientModule.sendHttpJsonRequestToSmartBidServerWithCallback( "AddCustomer", customerDetailsObject, 
                successfulCustomerDataSubmission, failureCustomerDataSubmission );
                
            }

            function successfulCustomerDataSubmission(responseTextFromServer) 
            {

                console.log("Successfully submitted the Customer Record Data => " + responseTextFromServer);
                document.getElementById("customerSignUpTest_container").innerHTML = "Customer SignUp Test Passed";
                document.getElementById("customerSignUpTest_container").style.color = "Blue";

                executeCustomerRecordRetrievalTest();
            }

            function failureCustomerDataSubmission(responseTextFromServer) 
            {

                console.log("Failed to Submit the Customer Record Data => " + responseTextFromServer);
                document.getElementById("customerSignUpTest_container").innerHTML = "Customer SignUp Test Failed";
                document.getElementById("customerSignUpTest_container").style.color = "Red";

                executeCustomerRecordRetrievalTest();
            }

            
            
            // Customer Record Retrieval Test

            async function executeCustomerRecordRetrievalTest()
            {
                
                let customerRecordRetrievalUrlParamsString = "RetrieveCustomer?EmailAddress=" + 
                    GlobalsForClientModule.customerRecordObject.EmailAddress;

                await HttpRestAPIClientModule.sendHttpRequestToSmartBidServerWithCallback( customerRecordRetrievalUrlParamsString, 
                successfulCustomerRecordRetrieval, failureCustomerRecordRetrieval );
                
            }

            function successfulCustomerRecordRetrieval(responseTextFromServer) 
            {

                console.log("Successfully Retrieved the Customer Record Data => " + responseTextFromServer);

                if( !ClientInputValidatorModule.validateRecordRetrievalObject( JSON.parse(responseTextFromServer)[0] , 
                    GlobalsForClientModule.validateCustomerRecordObject ) )
                {

                    console.log("Retrieved Customer Record values are incorrect");
                    document.getElementById("customerRecordRetrievalTest_container").innerHTML = "Customer Record Retrieval Test Failed";
                    document.getElementById("customerRecordRetrievalTest_container").style.color = "Red";
                        
                }

                else
                {

                    console.log("Retrieved Customer Record values matched that of expected");
                    document.getElementById("customerRecordRetrievalTest_container").innerHTML = "Customer Record Retrieval Test Passed";
                    document.getElementById("customerRecordRetrievalTest_container").style.color = "Blue";

                }

                executeCustomerLogInTest();

            }

            function failureCustomerRecordRetrieval(responseTextFromServer) 
            {

                console.log("Failed to Retrieve the Customer Record Data => " + responseTextFromServer);
                document.getElementById("customerRecordRetrievalTest_container").innerHTML = "Customer Record Retrieval Test Failed";
                document.getElementById("customerRecordRetrievalTest_container").style.color = "Red";

                executeCustomerLogInTest();

            }


            // Customer LogIn Test

            async function executeCustomerLogInTest()
            {
                
                let customerDetailsObject = {};

                customerDetailsObject.EmailAddress = GlobalsForClientModule.customerRecordObject.EmailAddress;
                customerDetailsObject.PasswordCode = window.btoa("abcd1234");

                await HttpRestAPIClientModule.sendHttpJsonRequestToSmartBidServerWithCallback( "AuthenticateUser", 
                customerDetailsObject, successfulCustomerLogIn, failureCustomerLogIn );
                
            }

            function successfulCustomerLogIn(responseTextFromServer) 
            {

                console.log("Successfully Logged Into the Server => " + responseTextFromServer);

                document.getElementById("customerLogInTest_container").innerHTML = "Customer Login Test Passed";
                document.getElementById("customerLogInTest_container").style.color = "Blue";

                executeCustomerRecordRemovalTest();
            }

            function failureCustomerLogIn(responseTextFromServer) 
            {

                console.log("Failed to LogIn to the Server => " + responseTextFromServer);
                document.getElementById("customerLogInTest_container").innerHTML = "Customer Login Test Failed";
                document.getElementById("customerLogInTest_container").style.color = "Red";

                executeCustomerRecordRemovalTest();
            }


            // Customer Record Removal Test

            async function executeCustomerRecordRemovalTest()
            {
                
                let customerRecordRemovalUrlParamsString = "DeleteCustomer?EmailAddress=" + 
                    GlobalsForClientModule.customerRecordObject.EmailAddress;

                await HttpRestAPIClientModule.sendHttpRequestToSmartBidServerWithCallback( customerRecordRemovalUrlParamsString, 
                successfulCustomerRecordRemoval, failureCustomerRecordRemoval );
                
            }

            function successfulCustomerRecordRemoval(responseTextFromServer) 
            {

                console.log("Successfully Removed the Customer Record Data => " + responseTextFromServer);

                document.getElementById("customerRecordRemoval_container").innerHTML = "Customer Record Removal Test Passed";
                document.getElementById("customerRecordRemoval_container").style.color = "Blue";

                executeCustomerRecordRemovalConfirmationTest();
            }

            function failureCustomerRecordRemoval(responseTextFromServer) 
            {

                console.log("Failed to Remove the Customer Record Data => " + responseTextFromServer);
                document.getElementById("customerRecordRemoval_container").innerHTML = "Customer Record Removal Test Failed";
                document.getElementById("customerRecordRemoval_container").style.color = "Red";

                executeCustomerRecordRemovalConfirmationTest();
            }


            // Customer Record Removal Confirmation Test

            async function executeCustomerRecordRemovalConfirmationTest()
            {
                
                let customerRecordRetrievalUrlParamsString = "RetrieveCustomer?EmailAddress=" + 
                    GlobalsForClientModule.customerRecordObject.EmailAddress;

                await HttpRestAPIClientModule.sendHttpRequestToSmartBidServerWithCallback( customerRecordRetrievalUrlParamsString, 
                successfulCustomerRecordRemovalConfirmation, failureCustomerRecordRemovalConfirmation );
                
            }

            function successfulCustomerRecordRemovalConfirmation(responseTextFromServer) 
            {

                console.log("Successfully Retrieved the Customer Record Data => " + responseTextFromServer);

                if( JSON.parse(responseTextFromServer).length != 0 )
                {

                    console.log("Couldn't confirm the deletion of Customer Record");
                    document.getElementById("customerRecordRemovalConfirmation_container").innerHTML = "Customer Record Removal Confirmation Test Failed";
                    document.getElementById("customerRecordRemovalConfirmation_container").style.color = "Red";
                        
                }

                else
                {

                    console.log("Was able to confirm the deletion of Customer Record");
                    document.getElementById("customerRecordRemovalConfirmation_container").innerHTML = "Customer Record Removal Confirmation Test Passed";
                    document.getElementById("customerRecordRemovalConfirmation_container").style.color = "Blue";

                }

                executePublishAssetFunctionalTestWrapper();

            }

            function failureCustomerRecordRemovalConfirmation(responseTextFromServer) 
            {

                console.log("Failed to confirm the removal of Customer Record Data => " + responseTextFromServer);
                document.getElementById("customerRecordRemovalConfirmation_container").innerHTML = "Customer Record Removal Confirmation Test Failed";
                document.getElementById("customerRecordRemovalConfirmation_container").style.color = "Red";

                executePublishAssetFunctionalTestWrapper();

            }

            
            // Publish Asset Test

            async function executePublishAssetFunctionalTestWrapper()
            {

                GlobalsForClientModule.currentCallBackFunctionForPublishAssetTest = executeAssetRecordRemovalTestWrapper;
                GlobalsForClientModule.currentObjectPublishAssetTest = GlobalsForClientModule.publishAssetObject;
                GlobalsForClientModule.currentPublishAssetTestContainer = "publishAssetTest_container";
                GlobalsForClientModule.currentAssetRetrievalTestContainer = "assetRecordRetrievalTest_container";

                PublishAssetValidatorModule.executePublishAssetFunctionalTest();
            }


            // Asset Record Removal Test

            async function executeAssetRecordRemovalTestWrapper(inputAssetId = 0)
            {

                GlobalsForClientModule.currentAssetRecordRemovalTestContainer = "assetRecordRemovalTest_container";
                GlobalsForClientModule.currentAssetRecordRemovalConfirmationTestContainer = "assetRecordRemovalConfirmation_container";

                GlobalsForClientModule.currentCallbackFunctionForAssetRemovalTest = executeOpenBidPlacementTestWrapperSetup;

                PublishAssetValidatorModule.executeAssetRecordRemovalTest(inputAssetId);
            }
                

            // Open Bidding : Publish Asset

            async function executeOpenBidPlacementTestWrapperSetup()
            {

                GlobalsForClientModule.currentCallBackFunctionForPublishAssetTest = executePlaceBidTestWrapper;
                GlobalsForClientModule.currentObjectPublishAssetTest = GlobalsForClientModule.publishAssetObject;
                GlobalsForClientModule.currentPublishAssetTestContainer = "placeOpenBid_PublishAssetTest_container";
                GlobalsForClientModule.currentAssetRetrievalTestContainer = "placeOpenBid_AssetRecordRetrievalTest_container";

                PublishAssetValidatorModule.executePublishAssetFunctionalTest();
            }

            async function executePlaceBidTestWrapper(inputAssetId = 0)
            {
                
                GlobalsForClientModule.currentAssetRecordId = inputAssetId;
                GlobalsForClientModule.currentAssetBidderCustomerId = 56;
                GlobalsForClientModule.currentAssetBiddingPrice = 8000000;
                GlobalsForClientModule.currentAssetBiddingType = "open";

                GlobalsForClientModule.currentRetrieveAssetObject = GlobalsForClientModule.retrieveBidObject;
                GlobalsForClientModule.currentRetrieveAssetObject.AssetId = inputAssetId;

                GlobalsForClientModule.placeBidTestContainer = "placeOpenBid_PlaceBidTest_container";
                GlobalsForClientModule.retrieveBidTestContainer = "placeOpenBid_RetrieveBidTest_container";

                GlobalsForClientModule.currentAssetSellerCustomerId = 55;
                GlobalsForClientModule.currentValidateBidObject = GlobalsForClientModule.currentRetrieveAssetObject;
                GlobalsForClientModule.retrieveBidAssetTestContainer = "placeOpenBid_RetrieveBidAssetTest_container";

                GlobalsForClientModule.executePlaceBidRecordCompletionTest = executePlaceBetterBidRecordTestWrapper;

                PlaceBidValidatorModule.executePlaceBidRecordTest();

            }

            async function executePlaceBetterBidRecordTestWrapper()
            {
                
                GlobalsForClientModule.currentAssetBidderCustomerId = 57;
                GlobalsForClientModule.currentAssetBiddingPrice = 8100000;
                GlobalsForClientModule.currentAssetBiddingType = "open";

                GlobalsForClientModule.currentRetrieveAssetObject = GlobalsForClientModule.retrieveBetterBidObject;
                GlobalsForClientModule.currentRetrieveAssetObject.AssetId = GlobalsForClientModule.currentAssetRecordId;

                GlobalsForClientModule.placeBidTestContainer = "placeOpenBid_PlaceBetterBidTest_container";
                GlobalsForClientModule.retrieveBidTestContainer = "placeOpenBid_RetrieveBetterBidTest_container";

                GlobalsForClientModule.currentAssetSellerCustomerId = 55;
                GlobalsForClientModule.currentValidateBidObject = GlobalsForClientModule.currentRetrieveAssetObject;
                GlobalsForClientModule.retrieveBidAssetTestContainer = "placeOpenBid_RetrieveBetterBidAssetTest_container";

                GlobalsForClientModule.executePlaceBidRecordCompletionTest = executeRemoveBidRecordTestWrapper;

                PlaceBidValidatorModule.executePlaceBidRecordTest();

            }

            async function executeRemoveBidRecordTestWrapper()
            {

                GlobalsForClientModule.currentBidRecordRemovalTestContainer = "placeOpenBid_bidRecordRemovalTest_container";
                GlobalsForClientModule.currentBidRecordRemovalConfirmationTestContainer = "placeOpenBid_bidRecordRemovalConfirmation_container";

                GlobalsForClientModule.executeDeleteBidRecordCompletionTest = executeRemoveAssetAfterBidsDeletionRecordTestWrapper;

                PlaceBidValidatorModule.executeBidsRecordRemovalTest();

            }

            async function executeRemoveAssetAfterBidsDeletionRecordTestWrapper(inputAssetId = 0)
            {

                GlobalsForClientModule.currentAssetRecordRemovalTestContainer = "placeOpenBid_assetBidRecordRemovalTest_container";
                GlobalsForClientModule.currentAssetRecordRemovalConfirmationTestContainer = "placeOpenBid_assetBidRecordRemovalConfirmation_container";

                GlobalsForClientModule.currentCallbackFunctionForAssetRemovalTest = executeSecretiveBiddingPlacementTestWrapperSetup;

                PublishAssetValidatorModule.executeAssetRecordRemovalTest(inputAssetId);

            }


            // Secretive Bidding : Publish Asset

            async function executeSecretiveBiddingPlacementTestWrapperSetup()
            {

                GlobalsForClientModule.currentCallBackFunctionForPublishAssetTest = executePlaceSecretiveBidTestWrapper;
                GlobalsForClientModule.currentObjectPublishAssetTest = GlobalsForClientModule.publishSecretiveAssetObject;
                GlobalsForClientModule.currentPublishAssetTestContainer = "placeSecretiveBid_PublishAssetTest_container";
                GlobalsForClientModule.currentAssetRetrievalTestContainer = "placeSecretiveBid_AssetRecordRetrievalTest_container";

                PublishAssetValidatorModule.executePublishAssetFunctionalTest();
            }

            async function executePlaceSecretiveBidTestWrapper(inputAssetId = 0)
            {
                
                GlobalsForClientModule.currentAssetRecordId = inputAssetId;
                GlobalsForClientModule.currentAssetBidderCustomerId = 56;
                GlobalsForClientModule.currentAssetBiddingPrice = 8000000;
                GlobalsForClientModule.currentAssetBiddingType = "secretive";

                GlobalsForClientModule.currentRetrieveAssetObject = GlobalsForClientModule.retrieveBidObject;
                GlobalsForClientModule.currentRetrieveAssetObject.AssetId = inputAssetId;

                GlobalsForClientModule.placeBidTestContainer = "placeSecretiveBid_PlaceBidTest_container";
                GlobalsForClientModule.retrieveBidTestContainer = "placeSecretiveBid_RetrieveBidTest_container";

                GlobalsForClientModule.currentAssetSellerCustomerId = 55;
                GlobalsForClientModule.currentValidateBidObject = GlobalsForClientModule.currentRetrieveAssetObject;
                GlobalsForClientModule.retrieveBidAssetTestContainer = "placeSecretiveBid_RetrieveBidAssetTest_container";

                GlobalsForClientModule.executePlaceBidRecordCompletionTest = executePlaceWorseSecretiveBidRecordTestWrapper;

                PlaceBidValidatorModule.executePlaceBidRecordTest();

            }

            async function executePlaceWorseSecretiveBidRecordTestWrapper()
            {
                
                GlobalsForClientModule.currentAssetBidderCustomerId = 57;
                GlobalsForClientModule.currentAssetBiddingPrice = 7900000;
                GlobalsForClientModule.currentAssetBiddingType = "secretive";

                GlobalsForClientModule.currentRetrieveAssetObject = GlobalsForClientModule.retrieveWorseBidObject;
                GlobalsForClientModule.currentRetrieveAssetObject.AssetId = GlobalsForClientModule.currentAssetRecordId;

                GlobalsForClientModule.placeBidTestContainer = "placeSecretiveBid_PlaceBetterBidTest_container";
                GlobalsForClientModule.retrieveBidTestContainer = "placeSecretiveBid_RetrieveBetterBidTest_container";

                GlobalsForClientModule.currentAssetSellerCustomerId = 55;
                GlobalsForClientModule.currentValidateBidObject = GlobalsForClientModule.retrieveBidObject;
                GlobalsForClientModule.retrieveBidAssetTestContainer = "placeSecretiveBid_RetrieveBetterBidAssetTest_container";

                GlobalsForClientModule.executePlaceBidRecordCompletionTest = executeRemoveSecretiveBidRecordTestWrapper;

                PlaceBidValidatorModule.executePlaceBidRecordTest();

            }

            async function executeRemoveSecretiveBidRecordTestWrapper()
            {

                GlobalsForClientModule.currentBidRecordRemovalTestContainer = "placeSecretiveBid_bidRecordRemovalTest_container";
                GlobalsForClientModule.currentBidRecordRemovalConfirmationTestContainer = "placeSecretiveBid_bidRecordRemovalConfirmation_container";

                GlobalsForClientModule.executeDeleteBidRecordCompletionTest = executeRemoveAssetSecretiveBiddingRecordTestWrapper;

                PlaceBidValidatorModule.executeBidsRecordRemovalTest();

            }

            async function executeRemoveAssetSecretiveBiddingRecordTestWrapper(inputAssetId = 0)
            {

                GlobalsForClientModule.currentAssetRecordRemovalTestContainer = "placeSecretiveBid_assetBidRecordRemovalTest_container";
                GlobalsForClientModule.currentAssetRecordRemovalConfirmationTestContainer = "placeSecretiveBid_assetBidRecordRemovalConfirmation_container";

                GlobalsForClientModule.currentCallbackFunctionForAssetRemovalTest = executeCloseAuctionTestWrapper;

                PublishAssetValidatorModule.executeAssetRecordRemovalTest(inputAssetId);

            }

            // Close Auction Test

            async function executeCloseAuctionTestWrapper()
            {

            }


        </script>

    </body>


</html>